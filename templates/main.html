{% extends "base.html" %}
    
{% block content %}
    <div class="sort-options">
        <form action="{{ url_for('main_page') }}" method="GET">
            <button type="submit" name="sort_by" value="name" class="sort-btn">Sort by Name</button>
            <button type="submit" name="sort_by" value="environmental_rating" class="sort-btn">Sort by Environmental Rating</button>
            <button type="submit" name="sort_by" value="price" class="sort-btn">Sort by Price</button>
            
        </form>
    </div>
    <div id="description-container"></div> <!-- Container for displaying the item description -->
    <ul class="product-list">
        {% for product in products %}
            <li class="product">
                <a href="{{ url_for('single_product_page', product_id=product.id)}}" class="product-link" data-product-id="{{ product.id }}">
                    <img src="{{ url_for('static', filename= product.image_name ) }}" alt="{{ product.name }}" width="300"/>
                </a>


                <div class="product-info">
                    <h3><a href="{{ url_for('single_product_page', product_id=product.id)}}" class="product-link" data-product-id="{{ product.id }}">{{ product.name }}</a></h3>
                    <p class="product-price">Price: Â£{{ product.price }}</p>
                    <p> Environmental Rating: {{product.environmental_rating}}</p>
                </div>


                <form action="{{ url_for('single_product_page', product_id=product.id) }}" method="POST" class="product-form">
                    {{ form.csrf_token }}
                    <input type="number" name="cart" value="1" min="1" class="product-quantity">
                    <button type="submit" class="submit-btn product-btn">Add to Cart</button>
                </form>
            </li>
        {% endfor %}
    </ul>
    
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productLinks = document.querySelectorAll('.product-link');

            productLinks.forEach(link => {
                link.addEventListener('mouseover', async (event) => {
                    const productId = event.target.dataset.productId;
                    descriptionContainer = document.getElementById('description-container');

                    // Make AJAX request to fetch description
                    const response = await fetch(`/get_description/${productId}`);
                    const data = await response.json();

                    // Display description in floating container
                    descriptionContainer.innerHTML = data.description;

                    // Position description container relative to mouse pointer
                    descriptionContainer.style.left = event.pageX + 'px';
                    descriptionContainer.style.top = event.pageY + 'px';

                    // Make description container visible
                    descriptionContainer.style.visibility = 'visible';
                });

                link.addEventListener('mouseout', () => {
                    // Clear description when mouse leaves the item
                    descriptionContainer.innerHTML = '';
                    descriptionContainer.style.visibility = 'hidden';
                });
            });
        });
    </script>
            
        
{% endblock %}
